# üöÄ Warden 0.7: The Great Glow-Up
*Where we stopped talking to the models and let the models talk to us*

---

## ‚ú® What's New This Time Around?

### üß† Smart Brains & Sharp Eyes (2025-11-19)

Remember when we used to guess which models were smart? Yeah, we were terrible at it. Now the API providers tell us exactly what each model can do:

- **No more hardcoded guessing games**: Model icons (üß† for reasoning, üëÅÔ∏è for vision) now come straight from the API's own metadata
- **Better provider support**: OpenAI o1/o3, DeepSeek reasoner, Perplexity sonar-reasoning ‚Äî all now properly identified as brainy boys
- **OpenRouter gets smart**: Fixed the parsing so OpenRouter actually tells us what its models can do
- **Every UI element got the memo**: All buttons, dropdowns, and tooltips check the API metadata instead of janky string matching

**Translation**: When you pick a model, we actually know what it can do. Revolutionary, we know.

---

### üí∞ Pricing That Makes Sense (2025-11-19)

Your models now come with price tags. Real ones. Not the made-up $0 nonsense from before:

- **OpenRouter pricing fixed**: We were dividing by zero. Metaphorically. Now prices actually show up ($2.00 instead of $0.00)
- **Input AND output pricing**: No more guessing games about what the second half of your token cost is
- **Beautiful, compact format**: Clean single-line pricing (`$2.00 ‚Üí $12.00/1M`) that doesn't take up half the screen
- **Instant model selector**: Removed those slow hover tooltips that made your finger hurt. Dropdown is now snappier than your morning coffee
- **Friendly model names**: Instead of `x-ai/grok-code-fast-1`, you get "Grok Code Fast 1 (xAI)" ‚Äî much nicer to look at

**The glow-up**: Model selector went from sluggish to lightning-fast, and you can actually see what things cost now.

---

### üîÑ Automatic Updates (The Sparkle Effect) (2025-11-18)

Tired of manually checking for updates like you're checking for your crush's Instagram story? We fixed that:

- **Hourly check-ins**: Warden automatically whispers to the update servers every hour to see if there's something new
- **Notifications when it matters**: Get a friendly nudge when a new version drops
- **Background download & install**: Updates happen while you sleep (or at least while you're not paying attention)
- **Manual "check now" option**: The impatient update button is still there in the About menu for the anxious among us
- **Cryptographically signed updates**: Everything's verified with EdDSA signatures so you know it's really from us
- **Beautiful release notes**: See what changed before you update, formatted all fancy-like

**For the nerdy details:**
- `UpdaterManager.swift` handles all the Sparkle magic
- `appcast.xml` is where we announce new versions (lives on GitHub, all dramatic-like)
- `SPARKLE_SETUP.md` and `RELEASE_PROCESS.md` have the boring-but-important infrastructure docs
- `scripts/create_sparkle_signature.sh` is your friend for signing releases

---

### üåê Web Search Just Got Pretty (2025-11-19)

Your searches now have a gorgeous dashboard. Seriously:

- **Real-time progress feed**: Watch your search happen in real-time with a cute status showing which sources Warden's currently reading
- **Fancy citation badges**: Citations now appear as sleek circular badges with that premium feel
- **Results preview panel**: See all your sources in one place with titles, URLs, relevance scores, and when they were published
- **Sticky search results**: Your search history stays visible even when you switch between chats (finally!)
- **Smart notifications**: Search completion alerts disappear on their own after 2 seconds (no annoying permanent reminders)
- **Clickable citations**: Click a badge to open that source in your browser ‚Äî no copy-paste gymnastics required
- **One-click copy**: Quick button to copy a URL if you need it for later
- **Graceful failures**: Something go wrong? Get a helpful error message with a retry button and settings link

**Bottom line**: Web search went from "utilitarian" to "actually looks good, I'd recommend it to my friends."

---

### üë• Personas Now Stick Around

You can finally add and save your own personas. Customize your assistant to match your vibe. Revolutionary stuff.

---

## üé® Visual Improvements (The Pretty Stuff)

### Message Bubbles Got Personality (2025-11-19)

Your chats now look like they belong in a magazine:

- **Your avatar on outgoing messages**: A cute circular avatar with your accent color in the corner ‚Äî very "you"
- **AI provider logos**: Each AI brings its own icon (Claude gets a cute face, ChatGPT gets its logo, etc.)
- **Subtle user bubble colors**: Switched from boring white to a soft accent color tint that matches your theme
- **Smart icon selection**: The app figures out which icon to show based on which AI is actually responding

**Result**: Chats are now more visually interesting and you can tell at a glance who's talking.

---

### Message Input Box (No Cursed Tinting) (2025-11-19)

Remember when your input box had that weird blue tint that looked like a monitor malfunction? We nuked that:

- **Removed the cursed material backgrounds**: Those semi-transparent tinted backgrounds are gone
- **Clean, neutral aesthetic**: Switched to a proper control background color that looks right in every theme
- **Applied consistently**: Fixed this across the input box, bottom container, and the whole chat view

**The fix**: Your input area now looks like it's supposed to, not like something broke.

---

### Model Selector Overhaul (2025-11-19)

The model picker went from "functional" to "frankly, kind of elegant":

- **Fancy ViewModel architecture**: Refactored the whole thing to be clean and organized
- **Smart result caching**: Search results are cached so we're not recalculating which models match every time you twitch your mouse
- **Debounced search**: Type smoothly ‚Äî the search waits 100ms to see if you're done before filtering results
- **Cleaner layout**: Stripped out the "Recently Used" clutter for a focused, Zen-like model selection experience

**The vibe**: Browsing 100+ models is now buttery smooth, and the dropdown actually feels premium.

---

## üóëÔ∏è What We Got Rid Of (The Good Cleanup)

### Spotlight Integration (2025-11-18)

We deleted the entire Spotlight indexing feature. Here's the corpse:

- üîç `SpotlightIndexManager` ‚Äî removed entirely
- üìö CoreSpotlight framework ‚Äî one less dependency cluttering the codebase
- üßπ All Spotlight references stripped from:
  - `ChatStore.swift` (indexing methods? gone)
  - `WardenApp.swift` (search handlers? adios)
  - `ContentView.swift` (notification listeners? bye)
  - Various UI files throughout the codebase
- üóÑÔ∏è Spotlight attributes purged from the Core Data model

**Why the murder?** Smaller app size, fewer background processes doing weird things, cleaner codebase. You'll never even notice it was there. Promise.

---

### Recently Used Models (2025-11-19)

The "Recently Used Models" feature is now a ghost story:

- üóëÔ∏è **The tracker is dead**: No more following which models you used and when
- üìâ **Code graveyard**: Deleted `RecentModelsManager` and all its little tracking helpers
- üéØ **Cleaner focus**: Model selector now only cares about your Favorites and the full list ‚Äî much simpler

**Why?** Made the code simpler and the UI cleaner. Sometimes less is more.

---

## üéØ The Great Code Diet (2025-11-19)

We did a massive cleanup initiative and removed about 500 lines of unnecessary code. Here's what we optimized:

### Architecture Cleanup
- **Unified message construction**: All message-building logic now lives in `ChatEntity` extensions instead of scattered around
- **Nuked hardcoded model metadata**: Deleted those massive, outdated dictionaries from `ModelMetadataFetcher` that nobody was maintaining
- **Cleaned up old data models**: Removed unused `struct Chat` and `struct Message` from `Models.swift`
- **Centralized API setup**: All the configuration logic now lives in `APIServiceManager` instead of everywhere

### Eliminated Duplication
- **One UUID extraction method**: All UUID logic is now in `MessageContent.swift` ‚Äî use it and only it
- **Single source of truth for parsing**: `MessageParser` is the only place that parses messages
- **Search logic lives in one place**: `TavilySearchService` now handles search commands and citation conversions
- **Date formatting**: Extracted to a `Date` extension so we format timestamps the same way everywhere

### Performance Boosts
- **Flattened view hierarchy**: `ChatBubbleView` now uses computed properties (`bubbleRow`, `toolbarRow`) instead of nested views
- **Lazy syntax highlighting**: Code highlighting now happens on `.onAppear` instead of during initialization
- **Debounced saves**: Core Data saves now debounce to reduce disk thrashing
- **Shared streaming logic**: Generic streaming handler in `APIServiceManager` means all providers stream the same way
- **Better error UI**: `ErrorBubbleView` is now the standard for showing errors instead of ad-hoc implementations

### Code Quality
- **New font helper**: `chatFont(size:)` extension for consistent typography everywhere
- **Removed dead imports**: Cleaned up 10+ files by removing unnecessary imports
- **Consolidated HTML**: Code syntax highlighting HTML lives in `AppConstants` now
- **Asset cleanup**: Removed redundant images from the asset catalog
- **Extracted small views**: `UserBubble`, `AssistantBubble`, `SystemBubble` are now organized subviews in `ChatBubbleView`
- **Deleted redundant files**: `SystemMessageBubbleView.swift` is now a bad memory

**The score**: ~500 lines deleted, code is easier to maintain, everything runs better.

---

## üêõ Fixes (The Bug Fixes That Actually Matter)

### Modernized Deprecated APIs (2025-11-19)

- **Updated onChange**: Switched from the old `onChange(of:perform:)` to modern closure syntax with proper old/new value parameters
- **Fixed Color initialization**: `Color(.systemBackground)` now properly uses `Color(nsColor: .controlBackgroundColor)` on macOS
- **Cleaned up warnings**: Removed unused variable warnings in the rotation logic

**Result**: No more compiler warnings about deprecated stuff, and the code actually matches modern Swift best practices.

---

### ShapeStyle Fill Magic (2025-11-19)

Fixed a tricky bug where conditional `ShapeStyle` fills in the message input view wouldn't render:

- Wrapped dynamic shape styles with `AnyShapeStyle` to make them compile and render properly
- This was one of those bugs that only happens in complex conditional rendering scenarios

**Translation**: Message input backgrounds now render correctly in all themes.

---

### Sidebar Settings Button (2025-11-18)

The settings button in the sidebar was doing its own thing:

- **Changed behavior**: Now opens preferences in a new window instead of inline
- **Better UX**: Aligns with the recent preferences window redesign
- **Consistent flow**: Settings are now consistently accessed through their own window

---

## üìä Quality Checklist

‚úÖ Build verified and working (CoreSpotlight isn't even a memory anymore)  
‚úÖ Zero Spotlight references lingering anywhere  
‚úÖ All Core Data cleanup done  
‚úÖ Code is leaner and meaner  
‚úÖ Everything compiles without warnings  

---

## What's Next?

Check out `0.7-ROADMAP.md` for what's cooking. There's some spicy stuff coming. üå∂Ô∏è
