# ğŸš€ Warden 0.7 Changelog

## API-Driven Model Capabilities (2025-11-19)
- **Removed hardcoded capability detection**: Model capability icons (brain ğŸ§  for reasoning, eye ğŸ‘ï¸ for vision) now use API-provided metadata instead of string matching
- **Enhanced provider metadata**: Added reasoning capability to OpenAI o1/o3 models, DeepSeek reasoner, Perplexity sonar-reasoning models
- **OpenRouter capability parsing**: Correctly extracts capabilities from OpenRouter API response
- **Metadata-based UI**: All UI components now check `metadata.hasReasoning` / `metadata.hasVision` instead of hardcoded model name lists

## Model Metadata & Display Improvements (2025-11-19)
- **Integrated metadata fetching**: Fixed metadata cache initialization to actually fetch pricing and capabilities from API providers
- **Fixed OpenRouter pricing**: Corrected unit conversion from per-token to per-1M-tokens (prices now show correctly instead of $0)
- **Added output pricing**: All UI components now display both input and output token pricing
- **Optimized model selector performance**: Removed expensive hover tooltips, dropdown is now instantly responsive
- **Improved pricing display format**: Compact single-line format with 2 decimals ($2.00 â†’ $12.00/1M)
- **Friendly model names**: Models now display as readable names (e.g., "Grok Code Fast 1 (xAI)" instead of "x-ai/grok-code-fast-1")

---

## [0.7.0] - In Development

---

## âœ¨ Added

### API Response Parsing Standardization (2025-11-19)

- ğŸ”§ **Standardized parsing**: Unified API response parsing methods across all handlers
- ğŸ§  **OpenRouter enhancements**: Enhanced parsing to include reasoning and robust content handling
- ğŸ›¡ï¸ **Error handling**: Improved error handling for malformed API responses

### Image Caching & UI Materials (2025-11-19)

- ğŸ–¼ï¸ **Image caching**: Implemented image caching for better performance
- ğŸ¨ **SwiftUI materials**: Updated UI backgrounds with native SwiftUI materials for modern look

### Automatic Updates via Sparkle â€” **Stay Fresh!** (2025-11-18)

Warden now supports automatic updates with zero user effort:

- ğŸ”„ **Auto-Check**: Checks for new versions every hour automatically
- ğŸ”” **Notifications**: Users get notified when updates are available
- ğŸš€ **Seamless Installation**: Updates download and install in the background
- ğŸ¯ **Manual Check**: "Check for Updates..." option in the About menu for on-demand checks
- ğŸ›¡ï¸ **Secure**: Updates are signed with EdDSA signatures for verification
- ğŸ“‹ **Release Notes**: Beautiful formatted release notes shown before updating

**For Developers:**
- `UpdaterManager.swift` handles all Sparkle integration
- `appcast.xml` is the release feed (hosted on GitHub)
- `SPARKLE_SETUP.md` has detailed setup instructions for first-time key generation
- `RELEASE_PROCESS.md` documents the complete release workflow
- `scripts/create_sparkle_signature.sh` helper for generating update signatures
- All configuration in `Info.plist` (SUFeedURL, SUShowReleaseNotes, etc.)

## Features

### Web Search UX Enhancements
- **Real-time search progress**: Visual feedback showing search query, fetching status, and source count
- **Enhanced citation badges**: Inline citations now appear as prominent circular badges with SF Symbol-style design
- **Search results preview**: Expandable panel showing all web sources with titles, URLs, relevance scores, and publication dates
- **Persistent search results**: Search results remain visible when switching between chats
- **Auto-dismiss notifications**: Search completion alerts automatically dismiss after 2 seconds
- **Interactive citations**: Click citation badges to open source URLs directly in browser
- **Copy functionality**: Quick copy button for source URLs in results preview
- **Error handling**: Comprehensive error states with retry and settings options

### Other Features
- Add and use new persona

**Workflow:**
1. Build and notarize the new version
2. Create GitHub release with the notarized DMG
3. Generate signature for the DMG
4. Update `appcast.xml` with release details
5. Push to main â€” users automatically notified and can update

---

## ğŸ—‘ï¸ Removed

### Spotlight Integration â€” **Bye Bye!** (2025-11-18)

We ripped out the entire Spotlight indexing feature. Here's what went away:

- ğŸ” Deleted the `SpotlightIndexManager` utility class
- ğŸ“š Removed CoreSpotlight framework (one less dependency to worry about)
- ğŸ§¹ Cleaned up Spotlight references from:
  - `ChatStore.swift` â€” removed indexing methods and background tasks
  - `WardenApp.swift` â€” removed search handler and activity continuation
  - `ContentView.swift` â€” removed notification listeners
  - Various UI files (`ProjectSummaryView`, `ChatListRow`, `ProjectListView`)
- ğŸ—„ï¸ Removed Spotlight attributes from the Core Data model

**Why?** Smaller app size, fewer background processes running, cleaner codebase. And don't worry â€” this was super internal stuff. You won't miss it.

---

## âœ¨ Changed

### Message Bubbles & Avatars â€” **Better Visual Hierarchy!** (2025-11-19)

Enhanced message appearance with provider identification and user avatars:

- ğŸ‘¤ **User avatars**: Cute circular avatars with accent color on outgoing messages
- ğŸ¤– **AI provider logos**: Provider-specific icons on incoming messages (OpenAI, Claude, Gemini, etc.)
- ğŸ¨ **User bubble color**: Changed to subtle accent color tint for better visual cohesion
- âœ¨ **AI bubble icons**: Smart icon selection based on API provider type

### Message Input Box â€” **No Weird Tint!** (2025-11-19)

- ğŸ¨ Removed material backgrounds that caused unwanted tinting
- âœ¨ Switched to clean control background color for consistent appearance
- ğŸ“ Applied fix across input container, bottom container, and chat view

### Model Selector â€” **Cleaner UI!** (2025-11-18)

The model selector just got a facelift. Everything's now in one convenient dropdown:

- ğŸ“Œ Favorites and Recently Used sections moved inside the dropdown
- â– Removed the separate Favorites toolbar button
- ğŸ¯ No more filter toggle buttons cluttering the header
- âœ¨ Sections appear at the top of the dropdown when you're not searching
- **Result:** Way cleaner, easier to use

### Model Pricing â€” **Now Live!** (2025-11-18)

Models now show pricing information right in the interface:

- ğŸ’° Live pricing fetched from OpenRouter API
- ğŸ·ï¸ Shows pricing like `$0.001/1M` with cute cost indicators (`$` / `$$` / `$$$`)
- ğŸ“Š Different fetchers for different providers (OpenAI, Anthropic, Gemini, Mistral, etc.)
- ğŸ  Self-hosted providers (Groq, Ollama, LMStudio) marked as free
- âš ï¸ Staleness warning if pricing data is older than 30 days
- ğŸ“‹ Source attribution so you know where the data came from

### Model Selector Performance â€” **Turbocharged!** (2025-11-18)

We made things a lot snappier when you're browsing models:

- âš¡ Pre-calculate model scores instead of recalculating during sorting
- ğŸ’¾ Cache search text lowercasing (no repeated string transformations)
- ğŸ¯ Pre-calculate metadata and favorite status to avoid multiple lookups
- ğŸš€ Early exit optimization for favorited models
- **Result:** Scrolling through 100+ models is now buttery smooth with way less memory overhead

### Button Styling â€” **Fresh & Modern** (2025-11-18)

All the buttons got a style upgrade:

- ğŸ”˜ Rounded corners now 8-10px for that soft, modern look
- âœ‹ Hover effects with subtle scale animations (1.02x on hover, 0.97x when pressed)
- ğŸ¨ Enhanced shadows and material backgrounds for better visual feedback
- ğŸ†• New `ModernButton.swift` component with primary, secondary, tertiary, and destructive variants for future use
- **Updated buttons:** ToolbarButton, RephraseButton, FavoriteQuickAccessBar, ThemeMode, and more

---

## ğŸ› Fixed

### Build & Deprecated API Usage (2025-11-19)

- ğŸ”„ Updated deprecated `onChange(of:perform:)` to modern closure syntax with old/new value parameters
- ğŸ¨ Fixed `Color(.systemBackground)` initialization to use `Color(nsColor: .controlBackgroundColor)`
- âœ… Removed unused variable warnings in rotation logic

### ShapeStyle Fill Issue (2025-11-19)

- ğŸ¨ Fixed conditional `ShapeStyle` fills in message input view by wrapping with `AnyShapeStyle`
- Resolves rendering issues with dynamic shape styles

### Sidebar Settings Button (2025-11-18)

- âš™ï¸ Settings button in sidebar now opens preferences in a new window instead of inline
- Better alignment with the recent preferences window redesign

---

## ğŸ“ Notes

âœ… Build verified and working (no more CoreSpotlight required)  
âœ… Zero Spotlight references lingering in the codebase  
âœ… All Core Data cleanup done  

**More coming soon!** Check out `0.7-ROADMAP.md` for what's next. ğŸ¯
