# Warden v0.8 - Feature & Refactoring Plan

## Major Features

- [ ] **Command Palette** (Ctrl+K or Cmd+K)
  - Quick access to all chat actions (new chat, export, delete, etc.)
  - Model/service switching
  - Settings navigation
  - Persona switching
  - Search functionality
  - Web search controls

- [ ] **MCP (Model Context Protocol) Functionality**
  - Integrate Claude's MCP for extended AI capabilities
  - Tool/resource discovery
  - Custom server support
  - Enhanced context passing

- [ ] **macOS 26 Icons & UI Updates**
  - Updated SF Symbols for latest macOS design language
  - Refresh icon assets across app
  - Modern visual consistency

## Code Refactoring & Cleanup

### High Priority Refactoring

- [ ] **Notification System Centralization**
  - Extract 50+ hardcoded notification strings
  - Create typed `NotificationManager` with enum-based definitions
  - Replace all string literals with strongly-typed notifications
  - Files affected: `WardenApp.swift`, `ContentView.swift`, `ChatView.swift`, and 50+ others

- [ ] **UserDefaults/Preferences Management**
  - Consolidate scattered `@AppStorage` properties (across 30+ files)
  - Create `PreferencesManager` singleton for centralized preference access
  - Implement typed accessor methods
  - Files affected: `ChatView.swift`, `ContentView.swift`, settings views

- [ ] **MessageManager Refactoring** (Currently 400+ lines)
  - Split into specialized managers:
    - `StreamingManager` - Handle streaming responses
    - `SearchManager` - Handle web search integration
    - `MessageSaveManager` - Handle persistence
    - `CacheManager` - Handle message caching
  - Consolidate async/callback patterns to full async/await
  - Extract debounce logic to dedicated utilities

- [ ] **Large View Decomposition**
  - Break down `ChatView.swift` (500+ lines, 48+ @State variables)
  - Create smaller, focused sub-components
  - Extract state into dedicated containers
  - Better state flow management

- [ ] **API Handler Architecture Improvements**
  - Replace `fatalError()` in `BaseAPIHandler` with proper protocol enforcement
  - Extract common JSON parsing logic into `ResponseParser` protocol
  - Refactor large handler methods (100+ lines) into smaller units
  - Reduce switch statement complexity in `APIServiceFactory`

- [ ] **Core Data Management Cleanup**
  - Extract repeated save logic into centralized retry mechanism
  - Create `CoreDataRepository` protocol for CRUD operations
  - Move migration logic into dedicated `DatabaseMigration` manager
  - Consolidate database patching logic

### Medium Priority Cleanup

- [ ] **Logging Infrastructure**
  - Replace 100+ scattered `print()` statements
  - Implement proper `Logger` using `os.log`
  - Add logging levels (debug, info, warning, error)
  - Create `Utilities/Logger.swift`

- [ ] **Constants File Reorganization**
  - Split monolithic `AppConstants.swift` (300+ lines) into:
    - `UIConstants.swift` (colors, fonts, sizes)
    - `APIConstants.swift` (API configurations)
    - `PersonaConstants.swift` (AI personas)
    - `SearchConstants.swift` (Tavily settings)

- [ ] **Error Handling Standardization**
  - Create comprehensive `WardenError` enum
  - Implement `LocalizedError` protocol for user-facing messages
  - Establish consistent error recovery patterns
  - Add error localization support

- [ ] **Global Hotkey Handler Improvements**
  - Extract hardcoded key mappings to configuration
  - Create `HotkeyRegistry` for conflict detection
  - Improve validation and error handling

- [ ] **Async/Await Consolidation**
  - Migrate remaining callback patterns to async/await
  - Standardize background queue usage
  - Improve concurrency safety

### Low Priority Polish

- [ ] **Code Style & Conventions**
  - Audit 120 character line limit enforcement
  - Standardize indentation (4 spaces)
  - Review naming conventions (Warden-specific patterns)

- [ ] **Documentation**
  - Add inline documentation for complex logic
  - Create architecture diagrams
  - Document state flow patterns

## Command Palette Feature Implementation

### Chat Management Commands
- [ ] New Chat (already has Cmd+N hotkey)
- [ ] New Window (already has Cmd+Opt+N hotkey)
- [ ] Retry Last Message (already has Cmd+R hotkey)
- [ ] Copy Last Response (already has Cmd+Shift+C hotkey)
- [ ] Copy Entire Chat (already has Cmd+Shift+A hotkey)
- [ ] Export Chat (already has Cmd+Shift+E hotkey)
- [ ] Delete Chat
- [ ] Search Chats
- [ ] Archive Chat
- [ ] Share Chat

### Model & Service Management
- [ ] Switch AI Model
- [ ] Switch API Service
- [ ] Favorite/Unfavorite Model
- [ ] Configure API Service
- [ ] Test API Connection
- [ ] View Model Capabilities
- [ ] Set Model Parameters (temperature, context, etc.)

### View Navigation
- [ ] Toggle Sidebar (already has Cmd+S hotkey)
- [ ] Focus Chat Input
- [ ] Focus Message List
- [ ] Toggle Preview Pane
- [ ] Full Screen Chat Mode

### Settings & Preferences
- [ ] Open Preferences (already has Cmd+, hotkey)
- [ ] Open API Services Settings
- [ ] Open AI Personas/Assistants
- [ ] Open Hotkeys Settings
- [ ] Open Tavily Search Settings
- [ ] Toggle Theme (Dark/Light/Auto)

### AI Personas
- [ ] Switch Persona (list all available)
- [ ] Create Custom Persona
- [ ] Edit Persona
- [ ] Delete Persona
- [ ] Reset to Default Personas

### Web Search Features
- [ ] Toggle Web Search
- [ ] Configure Search Settings
- [ ] View Last Search Results

### Assistant Features
- [ ] Rephrase Last Message
- [ ] Generate Chat Name
- [ ] Generate Project Summary
- [ ] Switch to Multi-Agent Mode
- [ ] Select Services for Multi-Agent

### File & Project Management
- [ ] Create Project/Folder
- [ ] Open Project
- [ ] Edit Project
- [ ] Delete Project
- [ ] Add Attachment (images/files)
- [ ] View Attachments

### Developer/Help
- [ ] Check for Updates
- [ ] View App Version
- [ ] Send Feedback
- [ ] Open Logs
- [ ] Validate API Keys

## Architectural Pattern Improvements

- [ ] **Dependency Injection**
  - Evaluate replacing service locator pattern
  - Improve testability and modularity

- [ ] **Reactive Data Flow**
  - Consider reducing NotificationCenter dependency
  - Explore reactive patterns for state management

- [ ] **Command Pattern**
  - Enable undo/redo functionality
  - Support command palette actions
  - Improve action handling consistency

- [ ] **Singleton Audit**
  - Review singleton usage across codebase
  - Consolidate where appropriate
  - Improve global state management

## Files Requiring Priority Attention

**Critical:**
- [ ] `Warden/Utilities/MessageManager.swift` - Too many responsibilities
- [ ] `Warden/UI/Chat/ChatView.swift` - Too large, excessive state
- [ ] `Warden/Store/ChatStore.swift` - Mixed concerns

**Important:**
- [ ] `Warden/Configuration/AppConstants.swift` - Monolithic file
- [ ] `Warden/Utilities/APIHandlers/` - Protocol usage needs improvement
- [ ] `Warden/WardenApp.swift` - Mixed initialization logic

**Helpful:**
- [ ] All files using `NotificationCenter.default.post()` - For centralization
- [ ] All files using `@AppStorage` - For preferences consolidation
- [ ] All `print()` statements - For logging infrastructure

## Testing & Verification

- [ ] Unit tests for refactored managers
- [ ] Integration tests for MessageManager split
- [ ] UI tests for command palette functionality
- [ ] Performance testing after refactoring
- [ ] Memory usage analysis
- [ ] Crash reporting validation

## Release Planning

- [ ] Semantic versioning (0.7.x â†’ 0.8.0)
- [ ] Beta testing cycle
- [ ] Documentation updates
- [ ] Migration guide if needed
- [ ] Release notes preparation
